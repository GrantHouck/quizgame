<!DOCTYPE html>
<html>
	<head>
		<title>!Quizard!</title>
		<style type="text/css">
			#form1
			{
				position: absolute;
				top: 140px;
				left: 400px;
			}
			#question-text
			{
				text-decoration: underline;
				font-size: 20px;
				font-weight: bold;
			}
			#controls
			{
				position: relative;
				display: block;
				left: -90px;
			}
			#next
			{
				width: 154px;
				
			}
		</style>
		<script type="text/javascript" src="./cookiefunctions.js"></script>
		<script type="text/javascript" src="./httprequest.js"></script>
		<script type="text/javascript">
			function loggedIn() {
				
				var userName = getCookie("quizardRecentVisitor")
				if (!(userName != "null"))
				{
					
					if (localStorage.getItem("quizardUser") && localStorage.getItem("quizardPassword"))
					{
						setCookie("quizardRecentVisitor",localStorage.getItem("quizardUser"),"","");
						setCookie("quizardPassword",localStorage.getItem("quizardPassword"),"","");
						alert("Welcome " + getCookie("quizardRecentVisitor"));
					}
					else
					{
						var userName = "";
						var password = "";
						alert("You need to be logged in to play dis game");
						while ((userName == null || userName == "") || (password == null || password == ""))
						{
							userName = prompt("Enter a user name");
							password = prompt("Enter a password");
						}
						localStorage.setItem("quizardUser", userName);
						localStorage.setItem("quizardPassword", password);
						setCookie("quizardRecentVisitor", userName, "", "");
						setCookie("quizardPassword", password, "", "");
					}
				}
				else
				{
					alert("Welcome back " + getCookie("quizardRecentVisitor"));
				}
				
				
			}
		
		//==================================================
		
		// THIS VERSION USES XML DOC FOR QUESTION STORAGE
		
		//==================================================
			// List of Question objects
			/*
			var allQuestions = [
				{question:"What is 1 + 1?",choices:[10,"Eleventy",24,0,2],correctAnswer:4},
				{question:"What is 11 + 11?", choices:[1111,22,111,101,2222,222],correctAnswer:1},
				{question:"Who is George Washington?", choices:["Thomas Jefferson","Ben Franklin", "Abe", "George Washington"],correctAnswer:3},
				{question:"What is a language?",choices:["Spanish","English","Spanglish","Japanese","Kawaii"],correctAnswer:4},
				{question:"Riddle me this..?",choices:[1,2,3,"this","random","wrong"],correctAnswer:2}
			];
			*/
			
			// Global vars
			//var questionsLeft = allQuestions.length;
			var currentQuestion = 0;
			var score = 0;
			var userAnswers = [];
			//var jsonQuestions = "";
			//var realList = this.realQuestions;
			var questionObjectList = new HttpRequest("questions.json", function(sResponseText) {
				var questions = JSON.parse(sResponseText);
				document.getElementById("question").innerHTML = "<p>" + questions[currentQuestion].question + "</p>";
				document.getElementById("choices").innerHTML = gen_radioButtons(questions[currentQuestion].choices, "rad_group1");
			});
			questionObjectList.send();
			
			//console.log(jsonQuestions);
			//jsonQuestionList = JSON.parse(jsonQuestions);
			//console.log(jsonQuestionList);
			
			
			
			/*
			//==================
			// XML Document vars
			//==================
			var xmlDoc = document.implementation.createDocument("","",null);
			xmlDoc.async = false;
			xmlDoc.load("question.xml");
			
			var qoas = xmlDoc.getElementsByTagName("qoa");
			var questions = xmlDoc.getElementsByTagName("question");
			var ansChoices = qoas[currentQuestion].getElementsByTagName("choice");
			
			var questionsLeft = questions.length;
			*/
			
			// Dynamically Generate Radio Buttons
			function gen_radioButtons (ans_options, radio_group_name) {
				var radioButtons = "";
				//var answer_choices = ans_options[currentQuestion].choices;
				for (var i = 0; i < ans_options.length; i++)
				{
					radioButtons += '<input type="radio" name="' + radio_group_name + '" value="' + i +'">' + ans_options[i] + '<br><br>';
				}
				return radioButtons;
			}
			
			// When next button is clicked, check answer, update score, remove/add in question and
			// answers.
			/*
			function onclick_buttonNext() {
			
			
				// Make sure the user selected an answer
				if (document.form1.rad_group1.value == "")
				{
					return;
				}
				
				userAnswers[currentQuestion] = document.form1.rad_group1.value;
				chosenAnswer = document.form1.rad_group1.value;
				
				// check if out of questions
				if (currentQuestion == questions.length - 1)
				{
					// need to check if last answer was correct and if so update score
					if (chosenAnswer == qoas[currentQuestion].getElementsByTagName("correctAnswer")[0].firstChild.nodeValue)
					{
						//score += 1;
					}
					
					
					//document.getElementById('question').innerHTML = "";
					//document.getElementById('choices').innerHTML = "";
					
					// remove content out of the form and display final score
					document.form1.innerHTML = "";
					for (var i = 0; i < userAnswers.length; i++)
					{
						if (userAnswers[i] == qoas[i].getElementsByTagName("correctAnswer")[0].firstChild.nodeValue)
						{
							score += 1;
						}
					}
					document.getElementById('final-score').innerHTML = "<h1>Your score is " + score +
					" out of " + questions.length + "</h1>";
				}
				
				// Not out of questions. if correct increase score, move on to next question.
				// then display the question and answer choices
				else if (chosenAnswer == qoas[currentQuestion].getElementsByTagName("correctAnswer")[0].firstChild.nodeValue) //used to be "allQuestions[currentQuestion].correctAnswer"
				{
					//score += 1;
					currentQuestion += 1;
					ansChoices = qoas[currentQuestion].getElementsByTagName("choice");
					document.getElementById('question').innerHTML = "<p id='question-text'>"+questions[currentQuestion].firstChild.nodeValue+"</p>";
					document.getElementById('choices').innerHTML = gen_radioButtons(ansChoices, "rad_group1");
					if (userAnswers[currentQuestion])
					{
						document.form1.rad_group1.value = userAnswers[currentQuestion];
					}
				}
				// Answer was incorrect so don't increase score but do everything else that was above
				else
				{
					currentQuestion += 1;
					var ansChoices = qoas[currentQuestion].getElementsByTagName("choice");
					document.getElementById('question').innerHTML = "<p id='question-text'>"+questions[currentQuestion].firstChild.nodeValue+"</p>";
					document.getElementById('choices').innerHTML = gen_radioButtons(ansChoices, "rad_group1");
					if (userAnswers[currentQuestion])
					{
						document.form1.rad_group1.value = userAnswers[currentQuestion];
					}
				}
			}
			*/
			function cb_buttonNext() {
			
				if (document.form1.rad_group1.value == "")
				{
					return;
				}
				
				var questionDiv = document.getElementById("question");
				var choicesDiv = document.getElementById("choices");
				
				
				var jsonObj = new HttpRequest("questions.json", function(sResponse) {
					
					jsonQuestions = JSON.parse(sResponse);
					if (currentQuestion == jsonQuestions.length - 1)
					{
						userAnswers[currentQuestion] = document.form1.rad_group1.value;
						// We are on the last question and
						// need to go to the score screen and 
						// tally the score and show the score
						for (var i = 0; i < userAnswers.length; i++)
						{
							if (userAnswers[i] == jsonQuestions[i].correctAnswer)
							{
								score += 1;
							}
						}
						document.form1.innerHTML = "<p>You scored " + score + " out of " + jsonQuestions.length +"</p>"; 
						
					}
					else
					{
						// We are not on the last question
						// Wee need to first save the users answer and then
						// go to the next question by loading 1. the next question
						// 2. the next set of choices
						userAnswers[currentQuestion] = document.form1.rad_group1.value;
						currentQuestion += 1;
						questionDiv.innerHTML = "<p>" + jsonQuestions[currentQuestion].question + "</p>";
						choicesDiv.innerHTML = gen_radioButtons(jsonQuestions[currentQuestion].choices, "rad_group1");
						if (userAnswers[currentQuestion])
						{
							document.form1.rad_group1.value = userAnswers[currentQuestion];
						}
					}
				});
				jsonObj.send();
			}
				
				
			/*
			function onclick_buttonPrev() {
				// make sure you don't go past the beginning of the array
				if (userAnswers.length == 0 || currentQuestion == 0)
				{
					return;
				}
				// it is possible to go back so decrease the current question index,
				// load the question and answer options, load the answer
				else
				{
					if (document.form1.rad_group1.value != "")
					{
						userAnswers[currentQuestion] = document.form1.rad_group1.value;
					}
					currentQuestion -= 1;
					//score -= 1;
					ansChoices = qoas[currentQuestion].getElementsByTagName("choice");
					document.getElementById('question').innerHTML = "<p id='question-text'>"+questions[currentQuestion].firstChild.nodeValue+"</p>";
					document.getElementById('choices').innerHTML = gen_radioButtons(ansChoices, "rad_group1");
					document.form1.rad_group1.value = document.form1.rad_group1[userAnswers[currentQuestion]].value;
				}
			}
			*/
			
			function cb_buttonPrev() {
				
				if (currentQuestion == 0)
				{
					return;
				}
				
				var jsonObj = new HttpRequest("questions.json", function(sResponse) {
					
					var jsonQuestions = JSON.parse(sResponse);
					
					// save the current choice in userAnswers
					// decrease currentQuestion by 1
					// load the previous (now current) question
					// load the previous (now current) set of choices
					// load the users choice from userAnswers
					
					if (document.form1.rad_group1.value)
					{
						userAnswers[currentQuestion] = document.form1.rad_group1.value;
					}
					currentQuestion -= 1;
					document.getElementById('question').innerHTML = "<p>" + jsonQuestions[currentQuestion].question + "</p>";
					document.getElementById('choices').innerHTML = gen_radioButtons(jsonQuestions[currentQuestion].choices, "rad_group1");
					document.form1.rad_group1.value = userAnswers[currentQuestion];
					
					
					
				});
				jsonObj.send();
			}
					
			
			
		</script>
	</head>
	<body>
		
		<div id="final-score"></div>
		<form name="form1" id="form1">
			<div id="question"></div>
			<div id="choices"></div>
			<div id="controls">
			<input name="prev" type="button" value="<--- Previous Question" id="prev">
			<input name="next" type="button" value="Next Question ---->" id="next">
			</div>
			
		</form>
	
	
		<script type="text/javascript">
			
			//document.getElementById('question').innerHTML = "<p id='question-text'>"+ jsonQuestions[currentQuestion].question +"</p>";
			//document.getElementById('choices').innerHTML = gen_radioButtons(jsonQuestions[currentQuestion].choices, "rad_group1");
			document.getElementById('next').onclick = cb_buttonNext;
			document.getElementById('prev').onclick = cb_buttonPrev;
			window.onload = loggedIn;
		</script>
	
	</body>
</html>